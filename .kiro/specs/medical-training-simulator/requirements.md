# 要件定義書

## 概要

この医療トレーニングシミュレーターは、医学生、研修医、一般医師、および医学に興味のある人々に現実的な臨床訓練体験を提供する包括的なWebアプリケーションです。システムは外来と入院の2つの主要モードを特徴とし、AI生成患者ペルソナ、インタラクティブな3D患者モデル、電子カルテシミュレーション、包括的な診断ワークフローを備えています。シミュレーターはLLM技術を使用して現実的な患者反応、検査結果、臨床シナリオを生成し、医学教育を向上させるための即座のフィードバックとスコアリングを提供します。

## 要件

### 要件1

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、外来と入院の両方の設定でカスタマイズ可能な患者と練習したい。多様な臨床シナリオを経験するために。

#### 受入基準

1. システムが開始されたとき、外来モードまたは入院モードを選択するオプションを提供すること
2. モードが選択されたとき、診療科（消化器内科、循環器内科など）を選択するオプションを提供すること
3. 診療科が選択されたとき、症例の難易度（初級、中級、上級）を選択するオプションを提供すること
4. オプションとして、特定の疾患を選択できる機能を提供すること
5. 患者生成パラメータが設定されたとき、GPT-o3を使用して医療シミュレーションに必要なすべての詳細情報を含む包括的な患者ペルソナを生成すること
6. 患者ペルソナには、年齢、主訴、既往歴、身体所見、遺伝的データ、家族歴、社会歴、薬歴、アレルギー歴、バイタルサイン、検査データベースライン値を含むこと
7. 将来の拡張が必要な場合、詳細な手動患者情報入力をサポートすること

### 要件2

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、3D患者モデルと対話し、チャットインターフェースを通じて問診と面接を行いたい。患者コミュニケーションと診察スキルを練習するために。

#### 受入基準

1. 患者ペルソナが生成されたとき、患者プロファイルに基づいて問診票データを作成すること
2. 問診票データが利用可能になったとき、Three.jsを使用して3D患者モデルをレンダリングすること
3. 3Dモデルが表示されたとき、リアルタイムチャットベースの問診インターフェースを開始すること
4. チャットインターフェースでは、研修生が自由に質問を入力でき、患者ペルソナに基づいてLLMが現実的な患者回答を生成すること
5. 問診の回答が受信されたとき、シミュレートされた電子カルテ形式で患者情報を自動更新すること
6. 身体診察が必要なとき、3Dモデルの身体部位をクリックしてLLM生成の診察所見をトリガーできること
7. チャット履歴は電子カルテ内に問診記録として保存されること

### 要件3

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、シミュレートされたEMRシステムを通じて検査と画像検査をオーダーしたい。臨床意思決定と診断ワークフローを練習するために。

#### 受入基準

1. シミュレートされたEMRが表示されたとき、オーダー入力インターフェースを含むこと
2. 血液検査をオーダーするとき、特定の検査項目の選択を可能にすること
3. 画像検査をオーダーするとき、解剖学的部位選択付きのCT、MRI、エコーのオプションを提供すること
4. 検査オーダーが提出されたとき、患者ペルソナと基礎疾患に基づいてLLMを使用して現実的な結果を生成すること
5. 検査結果が保留中のとき、現実的な待ち時間をシミュレートし、他の患者への切り替えを可能にすること
6. 画像結果が準備できたとき、放射線学的解釈付きの適切なレポート形式で提示すること

### 要件4

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、現実的な時間遅延で複数の患者を同時に管理したい。効率的な臨床ワークフロー管理を練習するために。

#### 受入基準

1. 複数の患者がアクティブなとき、患者切り替えインターフェースを提供すること
2. 検査結果が保留中のとき、待機期間中に他の患者との作業を可能にすること
3. 患者間を切り替えるとき、個々の患者の状態と進行を維持すること
4. 検査結果が利用可能になったとき、適切にユーザーに通知すること

### 要件5

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、適切なフォローアップケアで入院と退院の決定を行いたい。ケア調整と治療計画を練習するために。

#### 受入基準

1. 外来モードで入院が適応されるとき、入院モードへの切り替えを可能にすること
2. 入院モードのとき、点滴管理と薬剤投与インターフェースを提供すること
3. 日次進行が必要なとき、時間を進める「次の日」ボタンを含むこと
4. 時間が進むとき、治療決定に基づいてLLMを使用して患者バイタルと臨床データを更新すること
5. 退院が適切なとき、処方箋作成と退院計画を可能にすること
6. フォローアップが必要なとき、選択可能な時間枠で将来の予約をスケジュールできること

### 要件6

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、臨床決定の現実的な結果を経験したい。適切と不適切な治療選択の両方から学ぶために。

#### 受入基準

1. フォローアップ予約が発生したとき、以前の治療決定に基づいてLLMを使用して患者状態を決定すること
2. 不適切な治療が提供されたとき、現実的な臨床悪化をシミュレートすること
3. 重篤な管理ミスが発生したとき、患者死亡や緊急事態などのシナリオを含むこと
4. 治療決定が行われたとき、後の評価のためにすべての臨床行動を追跡すること

### 要件7

**ユーザーストーリー:** 医学生、研修医、一般医師、または医学に興味のある人として、臨床パフォーマンスに関する包括的なフィードバックとスコアリングを受けたい。改善領域を特定し、進歩を追跡するために。

#### 受入基準

1. シミュレーションセッションが終了したとき、正しい診断と基礎病態生理を明らかにすること
2. 評価が完了したとき、行われたすべての臨床決定に関する詳細なフィードバックを提供すること
3. スコアが計算されたとき、数値スコアと文字グレード（SからDランク）を割り当てること
4. フィードバックが表示されたとき、適切と不適切な臨床行動の両方を強調すること
5. パフォーマンス評価が完了したとき、改善のための推奨事項を提供すること

### 要件8

**ユーザーストーリー:** システム管理者として、モダンなWeb技術と適切なアーキテクチャでアプリケーションを構築したい。効果的に保守、スケール、デプロイできるように。

#### 受入基準

1. アプリケーションが開発されるとき、主要フレームワークとしてNext.js 15を使用すること
2. コードが書かれるとき、型安全性のためにTypeScriptを使用すること
3. スタイリングが適用されるとき、レスポンシブデザインのためにTailwind CSSを使用すること
4. データ永続化が必要なとき、バックエンドサービスのためにSupabaseを使用すること
5. 3Dレンダリングが必要なとき、患者モデル可視化のためにThree.jsを使用すること
6. テストが実装されるとき、単体テストにVitest、エンドツーエンドテストにPlaywrightを使用すること
7. LLM統合が必要なとき、患者生成、結果シミュレーション、臨床更新にGPT-o3を使用すること
8. 追加ライブラリが必要なとき、機能強化のための適切な技術を推奨し実装すること